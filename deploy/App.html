<!DOCTYPE html>
<html>
<head>
    <title>DefectsByPriority</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Rally.apps.defectsbypriority.Calculator",{prepareChartData:function(store){for(var categories=[],resolveImmediately=[],highAttention=[],normal=[],low=[],none=[],i=30;i>=0;i--){var dayName=Ext.Date.format(Rally.util.DateTime.add(new Date,"day",-i),"D");"Sat"!==dayName&&"Sun"!==dayName&&(Ext.Array.push(categories,{label:Ext.Date.format(Rally.util.DateTime.add(new Date,"day",-i),"m/d"),date:Ext.Date.format(Rally.util.DateTime.add(new Date,"day",-i),"c")}),Ext.Array.push(resolveImmediately,0),Ext.Array.push(highAttention,0),Ext.Array.push(normal,0),Ext.Array.push(low,0),Ext.Array.push(none,0))}store.each(function(defect){Ext.Array.each(categories,function(day){defect.get("_ValidTo")>=day.date&&defect.get("_ValidFrom")<day.date&&("Resolve Immediately"===defect.get("Priority")?resolveImmediately[Ext.Array.indexOf(categories,day)]+=1:"High Attention"===defect.get("Priority")?highAttention[Ext.Array.indexOf(categories,day)]+=1:"Normal"===defect.get("Priority")?normal[Ext.Array.indexOf(categories,day)]+=1:"Low"===defect.get("Priority")?low[Ext.Array.indexOf(categories,day)]+=1:"None"===defect.get("Priority")&&(none[Ext.Array.indexOf(categories,day)]+=1))},this)});var labels=Ext.Array.map(categories,function(day){return day.label},this);return{categories:labels,series:[{name:"Resolve Immediately",data:resolveImmediately,color:"#EF3F35"},{name:"High Attention",data:highAttention,color:"#F47168"},{name:"Normal",data:normal,color:"#FCB5B1"},{name:"Low",data:low,color:"#E57E3A"},{name:"None",data:none,color:"#D9AF4B"}]}}});
                Ext.define("Rally.apps.defectsbypriority.App",{extend:"Rally.app.App",requires:["Rally.apps.defectsbypriority.Calculator"],componentCls:"app",items:[{xtype:"container",itemId:"chart",componentCls:"chart"}],launch:function(){},_stateCheckChanged:function(checkbox){},_priorityCheckChanged:function(checkbox){},_severityCheckChanged:function(checkbox){},getSettingsFields:function(){return[{xtype:"container",layout:"hbox",items:[{xtype:"rallynumberfield",fieldLabel:"Date<br />Range",value:30,minValue:1,maxValue:365,width:115,labelWidth:60,componentCls:"number-field"},{xtype:"rallycombobox",storeType:"Ext.data.Store",storeConfig:{fields:["value","range"],data:[{value:"day",range:"Days"},{value:"week",range:"Weeks"},{value:"month",range:"Months"},{value:"quarter",range:"Quarters"}]},width:80,value:"day",margin:"4 0 0 10",displayField:"range",valueField:"value"}]},{xtype:"fieldcontainer",fieldLabel:"States",defaultType:"checkboxfield",items:[{boxLabel:"Submitted",inputValue:"sub",id:"submitted",handler:this._stateCheckChanged},{boxLabel:"Open",inputValue:"open",id:"open",handler:this._stateCheckChanged},{boxLabel:"Unable to Reproduce",inputValue:"unable",id:"unable-to-reproduce",handler:this._stateCheckChanged},{boxLabel:"Fixed",inputValue:"fixed",id:"fixed",handler:this._stateCheckChanged},{boxLabel:"Verifying",inputValue:"verify",id:"verifying",handler:this._stateCheckChanged},{boxLabel:"Closed",inputValue:"closed",id:"closed",handler:this._stateCheckChanged},{boxLabel:"Deferred",inputValue:"defer",id:"deferred",handler:this._stateCheckChanged}]},{xtype:"fieldcontainer",fieldLabel:"Priorities",defaultType:"checkboxfield",items:[{boxLabel:"Resolve Immediately",inputValue:"resolve",id:"resolve-immediately",handler:this._priorityCheckChanged},{boxLabel:"High Attention",inputValue:"high",id:"high-attention",handler:this._priorityCheckChanged},{boxLabel:"Normal",inputValue:"normal",id:"normal",handler:this._priorityCheckChanged},{boxLabel:"Low",inputValue:"low",id:"low",handler:this._priorityCheckChanged},{boxLabel:"None",inputValue:"none",id:"none",handler:this._priorityCheckChanged}]},{xtype:"fieldcontainer",fieldLabel:"Severities",defaultType:"checkboxfield",items:[{boxLabel:"Crash/Data Loss",inputValue:"crash",id:"crash-data-loss",handler:this._severityCheckChanged},{boxLabel:"Major Problem",inputValue:"major",id:"major-problem",handler:this._severityCheckChanged},{boxLabel:"Minor Problem",inputValue:"minor",id:"minor-problem",handler:this._severityCheckChanged},{boxLabel:"Cosmetic",inputValue:"cosmetic",id:"cosmetic",handler:this._severityCheckChanged}]}]}});

            Rally.launchApp('Rally.apps.defectsbypriority.App', {
                name:"DefectsByPriority",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .chart {
    width: 750px;
    margin: 0 auto;
    margin-top: 10px;
}
.project {
	font-size: 12px;
	color: #747474;
}
.radio-buttons {
	display: inline;
}
.number-field {
	display: inline;
}
    </style>
</head>
<body></body>
</html>
